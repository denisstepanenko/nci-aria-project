<script src="/Scripts/jquery.signalR-2.0.3.js"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="/signalr/hubs"></script>

<div ng-controller="ChatCtrl" ng-init="init()">
    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="jumbotron">
        <div class="container">
            <h1>Chat Page</h1>
            <p>This is a template for a simple marketing or informational website. It includes a large callout called a jumbotron and three supporting pieces of content. Use it as a starting point to create something more unique.</p>
            <p><a class="btn btn-primary btn-lg" href="/#chat">Learn more &raquo;</a></p>
        </div>
    </div>

    <div class="container">
        <!-- Example row of columns -->
        <div class="row">
            <div class="col-md-5">

                <div class="friends panel panel-default">
                    <div class="">
                        <div class="navbar navbar-default">
                            <div class="container">
                                <ul class="nav navbar-nav">
                                    <li class="active" ng-class="{active:selectedTab==1}">
                                        <a href="" ng-click="friendsTabClick(1)">My Friends</a>
                                    </li>
                                    <li ng-class="{active:selectedTab==2}">
                                        <a href="" ng-click="friendsTabClick(2)">Find Friends</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="panel-body">
                        <!--My Friends-->
                        <div class="my-friends friend-search" ng-show="selectedTab==1">
                            <div class="search navbar-form ">
                                <div class="form-group">
                                    <input class="form-control" placeholder="friend@email.com, name, nickname" type="text" ng-model="myFriendSearchCriteria"  ng-trim="true" />
                                </div>
                                <button class="btn btn-default" ng-click="findMyFriends()">Find Friends</button>
                                <select class="form-control" ng-model="myFriendsPaginationData.itemsPerPage">
                                    <option selected="selected" value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                            <div class="results" ng-show="myFriends.length!=0">
                                <ul class="nav nav-pills nav-stacked">
                                    <li ng-repeat="friend in myFriends" ng-click="myFriendClick(friend)" ng-class="{active:activeFriend.id==friend.id}">
                                        <a class="name">{{friend.name}}
                                            <span class="remove-friend badge pull-right" ng-click="removeFriend(friend)">Remove</span>    
                                            <span class="call-friend badge pull-right" ng-click="callFriend(friend)">Call</span>
                                        </a>

                                    </li>
                                </ul>

                                <div class="pager">
                                    <pagination total-items="myFriendsPaginationData.totalItems" ng-model="myFriendsPaginationData.currentPage" max-size="myFriendsPaginationData.maxPageNumers" items-per-page="myFriendsPaginationData.itemsPerPage" ng-change="myFriendsPaginationData.pageChanged()" class="pagination-sm" boundary-links="true"></pagination>
                                </div>

                            </div>
                        </div>

                        <!--Non-Friends Search-->
                        <div class="friend-search" ng-show="selectedTab==2">
                            <div class="search navbar-form ">
                                <div class="form-group">
                                    <input class="form-control" placeholder="friend@email.com, name, nickname" type="text" ng-model="friendSearchCriteria"  ng-trim="true" />
                                </div>

                                <button class="btn btn-default" ng-click="findFriends()">Find Friends</button>
                                <select class="form-control" ng-model="friendsPaginationData.itemsPerPage">
                                    <option selected="selected" value="10">10</option>
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                            <div class="results" ng-show="friends.length!=0">
                                <ul class="nav nav-pills nav-stacked">
                                    <li ng-repeat="friend in friends">
                                        <a class="name">{{friend.name}}
                                            <span class="add-to-friends badge pull-right" ng-show="friend.allowAddFriend" ng-click="addToFriends(friend)">Add to Friends</span>
                                        </a>                                        
                                    </li>
                                </ul>

                                <div class="pager">
                                    <pagination total-items="friendsPaginationData.totalItems" ng-model="friendsPaginationData.currentPage" max-size="friendsPaginationData.maxPageNumers" items-per-page="friendsPaginationData.itemsPerPage" ng-change="friendsPaginationData.pageChanged()" class="pagination-sm" boundary-links="true"></pagination>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>


            <div class="col-md-5">
                <!--CHAT AREA-->

                <div class="chat-area" ng-show="activeFriend">
                    <div class="friends panel panel-default">
                        <div class="panel-heading">Chat History:
                            <label>{{activeFriend.name}}</label>
                        </div>
                        
                        <div class="video">
                            <!-- Video area -->
                            <div class="" id="video-container" ng-show="activeCallUser">                           
                                <div class="alert alert-danger" ng-show="videoError" >
                                    {{videoError}}
                                    <button class="btn btn-default" ng-click="endCall();callFriend(activeFriend);">Retry...</button>
                                </div>

                                <video id="their-video" autoplay></video>
                                <video id="my-video" muted="muted" autoplay></video>

                            </div>

                            <button class="btn btn-default" ng-click="callFriend(activeFriend)">Call</button>                            
                            <button class="btn btn-default" ng-click="endCall()">End Call</button>
                        </div>

                        <div class="messages">
                            <div class="list-group">
                                <div class="scrollable">
                                    <a class="list-group-item" ng-repeat="item in activeFriend.messageHistory">
                                        <div>
                                            <span class="badge pull-left">{{item.senderName}}</span>
                                            <span class="badge pull-right">{{item.datePosted}}</span>
                                        </div>
                                        <br />
                                        <p>{{item.message}}</p>
                                    </a>
                                </div>
                            </div>

                            <div class="pager">
                                <pagination total-items="chatHistoryPaginationData.totalItems" ng-model="chatHistoryPaginationData.currentPage" 
                                    max-size="chatHistoryPaginationData.maxPageNumers" items-per-page="chatHistoryPaginationData.itemsPerPage" 
                                    ng-change="chatHistoryPaginationData.pageChanged()" class="pagination-sm" boundary-links="true"></pagination>
                            </div>
                        </div>


                    </div>

                    <div class="friends panel panel-default">
                        <div class="panel-heading">New Message</label></div>
                        <div class="new-message form-group">
                            <textarea class="form-control validate[required]" rows="3" ng-model="textMessage"  ng-trim="true"></textarea>
                            <button ng-click="sendTextMessage()" class="form-control btn btn-primary pull-right">Send</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>



        <hr>

        <footer>
            <p>&copy; Company 2014</p>
        </footer>
    </div>
    <!-- /container -->
</div>
